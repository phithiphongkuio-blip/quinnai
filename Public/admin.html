<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quinn AI - Super Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style> body { font-family: 'Prompt', sans-serif; } ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: #1f2937; } ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; } </style>
</head>
<body class="bg-gray-900 min-h-screen text-gray-200">
    <div id="app" class="max-w-7xl mx-auto py-8 px-4">
        <header class="flex justify-between items-center mb-8 border-b border-gray-700 pb-6"><div class="flex items-center gap-3"><div class="bg-indigo-600 p-3 rounded-lg"><i class="fa-solid fa-crown text-2xl text-white"></i></div><div><h1 class="text-2xl font-bold text-white">Super Admin</h1><p class="text-sm text-gray-400">Control Center</p></div></div><div class="flex gap-4"><a href="dashboard.html" class="bg-gray-800 hover:bg-gray-700 text-gray-300 px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2"><i class="fa-solid fa-arrow-left"></i> Dashboard</a><button @click="logout" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-red-900/20"><i class="fa-solid fa-power-off mr-2"></i> Logout</button></div></header>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"><div class="bg-gray-800 p-6 rounded-xl border border-gray-700"><p class="text-gray-400 text-xs font-bold uppercase mb-1">Users</p><h3 class="text-3xl font-bold text-white">{{ users.length }}</h3></div><div class="bg-gray-800 p-6 rounded-xl border border-gray-700"><p class="text-gray-400 text-xs font-bold uppercase mb-1">Bots</p><h3 class="text-3xl font-bold text-green-400">{{ activeBots }}</h3></div><div class="bg-gray-800 p-6 rounded-xl border border-gray-700"><p class="text-gray-400 text-xs font-bold uppercase mb-1">Status</p><h3 class="text-3xl font-bold" :class="config.maintenanceMode ? 'text-red-500' : 'text-blue-400'">{{ config.maintenanceMode ? 'Maintenance' : 'Online' }}</h3></div></div>
        <div class="flex space-x-1 bg-gray-800 p-1 rounded-xl mb-6 w-fit border border-gray-700"><button @click="currentTab='overview'" :class="currentTab==='overview'?'bg-gray-700 text-white shadow':'text-gray-400 hover:text-white'" class="px-6 py-2 rounded-lg text-sm font-bold">Config</button><button @click="currentTab='users'" :class="currentTab==='users'?'bg-gray-700 text-white shadow':'text-gray-400 hover:text-white'" class="px-6 py-2 rounded-lg text-sm font-bold">Users</button><button @click="currentTab='logs'" :class="currentTab==='logs'?'bg-gray-700 text-white shadow':'text-gray-400 hover:text-white'" class="px-6 py-2 rounded-lg text-sm font-bold">Logs</button></div>

        <div v-if="currentTab === 'overview'" class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="bg-gray-800 p-6 rounded-xl border border-gray-700"><h3 class="font-bold text-white mb-4">Maintenance</h3><div class="flex items-center justify-between bg-gray-900/50 p-4 rounded-lg border border-gray-700"><div><p class="text-sm font-bold text-white">ปิดปรับปรุง</p></div><label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" v-model="config.maintenanceMode" @change="saveConfig" class="sr-only peer"><div class="w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:bg-red-600"></div></label></div></div><div class="bg-gray-800 p-6 rounded-xl border border-gray-700"><h3 class="font-bold text-white mb-4">Announcement</h3><div class="space-y-3"><input v-model="announcement.message" class="w-full bg-gray-900 border border-gray-600 rounded-lg p-3 text-white text-sm" placeholder="Message..."><div class="flex gap-2"><select v-model="announcement.type" class="bg-gray-900 border border-gray-600 rounded-lg p-2 text-white text-sm"><option value="info">Info</option><option value="warning">Warn</option><option value="danger">Danger</option></select><button @click="saveAnnouncement" class="bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-bold ml-auto">Post</button><button @click="clearAnnouncement" class="bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-bold">Clear</button></div></div></div></div>

        <div v-if="currentTab === 'users'" class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden">
            <table class="w-full text-sm text-left text-gray-300">
                <thead class="bg-gray-900/50 text-gray-400 uppercase text-xs"><tr><th class="p-4">User</th><th class="p-4">Access</th><th class="p-4 text-center">Status</th><th class="p-4 text-right">Actions</th></tr></thead>
                <tbody class="divide-y divide-gray-700">
                    <tr v-for="u in users" :key="u._id" class="hover:bg-gray-750">
                        <td class="p-4"><div class="font-bold text-white">{{ u.name }}</div><div class="text-xs text-gray-500">{{ u.email }}</div></td>
                        <td class="p-4">
                            <div v-if="u.role !== 'admin'" class="flex flex-wrap gap-3">
                                <label class="flex items-center space-x-2 text-xs text-gray-300 cursor-pointer bg-gray-900 px-2 py-1 rounded border border-gray-700 hover:border-gray-500"><input type="checkbox" value="facebook" v-model="u.access" @change="updateAccess(u)" class="rounded text-blue-500 bg-gray-800 border-gray-600 focus:ring-offset-0"><span>Facebook</span></label>
                                <label class="flex items-center space-x-2 text-xs text-gray-300 cursor-pointer bg-gray-900 px-2 py-1 rounded border border-gray-700 hover:border-gray-500"><input type="checkbox" value="tiktok" v-model="u.access" @change="updateAccess(u)" class="rounded text-gray-500 bg-gray-800 border-gray-600 focus:ring-offset-0"><span>TikTok</span></label>
                                </div>
                            <span v-else class="text-indigo-400 font-bold text-xs bg-indigo-900/30 px-2 py-1 rounded">ALL ACCESS</span>
                        </td>
                        <td class="p-4 text-center"><span v-if="u.isActive" class="text-green-400 text-xs">Active</span><span v-else class="text-red-500 text-xs">Banned</span></td>
                        <td class="p-4 text-right"><div class="flex justify-end gap-2" v-if="u.role !== 'admin'"><button @click="resetPassword(u._id, u.name)" class="bg-yellow-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold">Pass</button><button @click="loginAs(u._id)" class="bg-indigo-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold">View</button><button @click="toggleBan(u._id)" class="border px-3 py-1.5 rounded-lg text-xs font-bold">{{ u.isActive ? 'Ban' : 'Unban' }}</button></div></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div v-if="currentTab === 'logs'" class="bg-gray-800 rounded-xl border border-gray-700 overflow-hidden"><table class="w-full text-sm text-left text-gray-300"><thead class="bg-gray-900/50 text-gray-400 uppercase text-xs"><tr><th class="p-4">Time</th><th class="p-4">Action</th><th class="p-4">Details</th><th class="p-4 text-right">By</th></tr></thead><tbody class="divide-y divide-gray-700"><tr v-for="log in systemLogs" :key="log._id"><td class="p-4 text-xs text-gray-500">{{ new Date(log.timestamp).toLocaleString('th-TH') }}</td><td class="p-4 font-bold">{{ log.action }}</td><td class="p-4 text-gray-400 text-xs">{{ log.details }}</td><td class="p-4 text-right text-indigo-300">{{ log.actor }}</td></tr></tbody></table></div>
    </div>
    <script>
        const { createApp, ref, onMounted, computed } = Vue;
        createApp({
            setup() {
                const users = ref([]); const systemLogs = ref([]); const config = ref({ maintenanceMode: false }); const announcement = ref({ message: '', type: 'info', isActive: true }); const token = localStorage.getItem('quinn_token'); const currentTab = ref('overview');
                if (!token) window.location.href = 'index.html';
                const fetchData = async () => { try { const usersRes = await axios.get('/api/admin/users', { headers: { 'Authorization': `Bearer ${token}` } }); users.value = usersRes.data.users.map(u => ({...u, access: u.access || []})); const configRes = await axios.get('/api/system/config'); if(configRes.data) config.value = configRes.data; const annRes = await axios.get('/api/announcement'); if(annRes.data?.data) announcement.value = annRes.data.data; fetchLogs(); } catch (e) { alert('Access Denied'); window.location.href = 'dashboard.html'; } };
                const fetchLogs = async () => { try { const res = await axios.get('/api/admin/logs', { headers: { 'Authorization': `Bearer ${token}` } }); systemLogs.value = res.data.logs; } catch (e) {} };
                const saveConfig = async () => { try { await axios.post('/api/admin/system/config', config.value, { headers: { 'Authorization': `Bearer ${token}` } }); } catch(e) { alert(e.message); } };
                const saveAnnouncement = async () => { announcement.value.isActive = true; try { await axios.post('/api/admin/announcement', announcement.value, { headers: { 'Authorization': `Bearer ${token}` } }); alert('Saved!'); } catch(e) { alert(e.message); } };
                const clearAnnouncement = async () => { announcement.value = { message: '', type: 'info', isActive: false }; saveAnnouncement(); };
                const resetPassword = async (userId, userName) => { const newPass = prompt(`Set password for ${userName}:`); if (!newPass) return; try { await axios.post('/api/admin/reset-password', { userId, newPassword }, { headers: { 'Authorization': `Bearer ${token}` } }); alert('Reset!'); } catch (e) { alert('Error: ' + e.message); } };
                const toggleBan = async (userId) => { if(!confirm('Sure?')) return; await axios.post('/api/admin/toggle-ban', { userId }, { headers: { 'Authorization': `Bearer ${token}` } }); fetchData(); };
                const loginAs = async (userId) => { if(!confirm('Ghost Login?')) return; try { const res = await axios.post('/api/admin/login-as', { userId }, { headers: { 'Authorization': `Bearer ${token}` } }); localStorage.setItem('quinn_admin_backup', token); localStorage.setItem('quinn_token', res.data.token); localStorage.setItem('quinn_user', JSON.stringify(res.data.user)); window.location.href = 'dashboard.html'; } catch (e) { alert(e.message); } };
                const logout = () => { localStorage.clear(); window.location.href = 'index.html'; };
                const updateAccess = async (user) => { try { await axios.post('/api/admin/change-access', { userId: user._id, access: user.access }, { headers: { 'Authorization': `Bearer ${token}` } }); } catch(e) { alert(e.message); } };
                const activeBots = computed(() => users.value.filter(u => u.settings?.isBotActive).length);
                onMounted(() => fetchData());
                return { currentTab, users, systemLogs, config, announcement, activeBots, fetchData, fetchLogs, saveConfig, saveAnnouncement, clearAnnouncement, toggleBan, loginAs, logout, resetPassword, updateAccess };
            }
        }).mount('#app');
    </script>
</body>
</html>