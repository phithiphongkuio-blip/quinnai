<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Ads Manager by Quinn - Omni Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style> 
        body { font-family: 'Prompt', sans-serif; } 
        select { -webkit-appearance: none; -moz-appearance: none; appearance: none; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 4px; }
    </style>
</head>
<body class="bg-gray-100 h-screen overflow-hidden flex">

    <div id="app" class="flex w-full h-full">

        <aside class="w-64 bg-white border-r border-gray-200 flex-shrink-0 flex flex-col justify-between h-full">
            <div>
                <div class="h-16 flex items-center px-6 border-b border-gray-100">
                    <i class="fa-solid fa-robot text-indigo-600 text-2xl mr-3"></i>
                    <span class="font-bold text-xl text-gray-800 tracking-tight">Quinn AI</span>
                </div>
                <nav class="p-4 space-y-1">
                    <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 px-4 mt-4">Dashboards</div>
                    <a href="#" @click.prevent="currentView = 'overview'" :class="{'bg-indigo-50 text-indigo-600 border-r-4 border-indigo-600': currentView === 'overview'}" class="flex items-center px-4 py-3 text-gray-600 rounded-l-lg hover:bg-gray-50 transition"><i class="fa-solid fa-house w-6 mr-3"></i> ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</a>

                    <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 px-4 mt-6">Platforms</div>
                    <a href="#" @click.prevent="currentView = 'facebook'" :class="{'bg-indigo-50 text-indigo-600 border-r-4 border-indigo-600': currentView === 'facebook'}" class="flex items-center px-4 py-3 text-gray-600 rounded-l-lg hover:bg-gray-50 transition"><i class="fa-brands fa-facebook w-6 mr-3 text-blue-600"></i> Facebook Ads</a>
                    <a href="#" @click.prevent="currentView = 'tiktok'" :class="{'bg-indigo-50 text-indigo-600 border-r-4 border-indigo-600': currentView === 'tiktok'}" class="flex items-center px-4 py-3 text-gray-600 rounded-l-lg hover:bg-gray-50 transition"><i class="fa-brands fa-tiktok w-6 mr-3 text-black"></i> TikTok Ads</a>

                    <div class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 px-4 mt-6">System</div>
                    <a href="#" @click.prevent="currentView = 'settings'" :class="{'bg-indigo-50 text-indigo-600 border-r-4 border-indigo-600': currentView === 'settings'}" class="flex items-center px-4 py-3 text-gray-600 rounded-l-lg hover:bg-gray-50 transition"><i class="fa-solid fa-sliders w-6 mr-3"></i> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</a>
                </nav>
            </div>
            <div class="p-4 border-t border-gray-100">
                <div class="flex items-center gap-3 px-2">
                    <div class="w-8 h-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600 font-bold">{{ user.name ? user.name[0] : 'U' }}</div>
                    <div class="flex-1 min-w-0"><p class="text-sm font-medium text-gray-900 truncate">{{ user.name }}</p><p class="text-xs text-gray-500 truncate">Pro Plan</p></div>
                    <button @click="logout" class="text-gray-400 hover:text-red-500 transition"><i class="fa-solid fa-right-from-bracket"></i></button>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col h-full overflow-hidden relative">
            
            <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-8 flex-shrink-0">
                <h1 class="text-xl font-bold text-gray-800 capitalize">
                    <span v-if="currentView === 'overview'">üìä ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à</span>
                    <span v-if="currentView === 'facebook'">üíô ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Facebook Ads</span>
                    <span v-if="currentView === 'tiktok'">üñ§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ TikTok Ads</span>
                    <span v-if="currentView === 'settings'">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</span>
                </h1>
                <div class="flex items-center gap-2">
                    <button @click="showHunterModal = true" class="text-indigo-600 hover:text-indigo-800 text-xs font-bold bg-indigo-50 px-3 py-1.5 rounded-lg border border-indigo-100 flex items-center"><i class="fa-solid fa-crosshairs mr-1"></i> Interest</button>
                    <button @click="showAiModal = true" class="text-purple-600 hover:text-purple-800 text-xs font-bold bg-purple-50 px-3 py-1.5 rounded-lg border border-purple-100 flex items-center"><i class="fa-solid fa-wand-magic-sparkles mr-1"></i> Writer</button>
                    <button @click="showSpyModal = true" class="text-gray-700 hover:text-black text-xs font-bold bg-gray-100 px-3 py-1.5 rounded-lg border border-gray-200 flex items-center"><i class="fa-solid fa-user-secret mr-1"></i> Spy</button>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-8 custom-scrollbar">
                
                <div v-if="currentView === 'overview'" class="space-y-6 animate-fade-in">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><p class="text-gray-500 text-xs font-bold uppercase">‡∏¢‡∏≠‡∏î‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏ß‡∏°</p><h3 class="text-2xl font-bold text-gray-800 mt-1">{{ totalStats.spend.toLocaleString() }} ‡∏ø</h3></div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><p class="text-gray-500 text-xs font-bold uppercase">‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</p><h3 class="text-2xl font-bold text-green-600 mt-1">{{ totalStats.sales.toLocaleString() }} ‡∏ø</h3></div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><p class="text-gray-500 text-xs font-bold uppercase">ROAS ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</p><h3 class="text-2xl font-bold text-indigo-600 mt-1">{{ totalStats.roas }}</h3></div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><p class="text-gray-500 text-xs font-bold uppercase">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</p><h3 class="text-2xl font-bold mt-1" :class="totalStats.profit > 0 ? 'text-green-600' : 'text-red-500'">{{ totalStats.profit.toLocaleString() }} ‡∏ø</h3></div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                        <h3 class="font-bold text-gray-700 mb-4">‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°</h3>
                        <div class="space-y-4">
                            <div><div class="flex justify-between text-sm mb-1"><span class="font-bold text-blue-700"><i class="fa-brands fa-facebook mr-1"></i> Facebook</span><span>{{ totalStats.fbSpend.toLocaleString() }} ‡∏ö‡∏≤‡∏ó</span></div><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-blue-600 h-2.5 rounded-full" style="width: 100%"></div></div></div>
                            <div><div class="flex justify-between text-sm mb-1"><span class="font-bold text-black"><i class="fa-brands fa-tiktok mr-1"></i> TikTok</span><span>0 ‡∏ö‡∏≤‡∏ó (Mock)</span></div><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="bg-black h-2.5 rounded-full" style="width: 0%"></div></div></div>
                        </div>
                    </div>
                </div>

                <div v-if="currentView === 'facebook'" class="space-y-6 animate-fade-in">
                    <div class="flex flex-col sm:flex-row justify-between items-center bg-white p-4 rounded-xl shadow-sm gap-4">
                        <div class="flex items-center gap-3">
                            <span class="font-bold text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏≠‡∏ó:</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" v-model="settings.isBotActive" @change="saveSettings(false)" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-green-500"></div>
                                <span class="ml-3 text-sm font-medium" :class="settings.isBotActive ? 'text-green-600' : 'text-gray-500'">{{ settings.isBotActive ? 'On' : 'Off' }}</span>
                            </label>
                        </div>
                        <button @click="checkAdsNow" :disabled="loading" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow transition flex items-center w-full sm:w-auto justify-center"><i :class="loading ? 'fa-solid fa-circle-notch fa-spin' : 'fa-solid fa-rotate'" class="mr-2"></i> Update</button>
                    </div>

                    <div class="bg-white p-6 rounded-xl shadow-sm">
                        <h3 class="font-bold text-gray-700 mb-4">‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÄ‡∏á‡∏¥‡∏ô (Spend)</h3>
                        <div class="h-64"><canvas id="spendChart"></canvas></div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-4 border-b bg-gray-50 font-bold text-gray-700 flex justify-between items-center">
                            <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤ (Facebook)</span>
                            <span class="text-xs bg-gray-200 px-2 py-1 rounded text-gray-600">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {{ adsList.length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left whitespace-nowrap">
                                <thead class="bg-gray-100 text-gray-600 text-xs uppercase">
                                    <tr>
                                        <th class="p-3">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î</th>
                                        <th class="p-3 text-right">‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</th>
                                        <th class="p-3 text-right">‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞</th> 
                                        <th class="p-3 text-center">ROAS</th>
                                        <th class="p-3 text-right">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th>
                                        <th class="p-3 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="ad in paginatedAds" class="border-b hover:bg-gray-50">
                                        <td class="p-3 font-medium">{{ ad.name }}</td>
                                        <td class="p-3 text-right">{{ ad.spend.toLocaleString() }}</td>
                                        <td class="p-3 text-right text-indigo-600 font-bold">{{ ad.costPerMsg > 0 ? ad.costPerMsg : '-' }}</td>
                                        <td class="p-3 text-center font-bold" :class="ad.roas >= settings.targetRoas ? 'text-green-600' : 'text-gray-500'">{{ ad.roas }}</td>
                                        <td class="p-3 text-right font-bold" :class="ad.netProfit > 0 ? 'text-green-600' : 'text-red-500'">{{ ad.netProfit ? ad.netProfit.toLocaleString(undefined, {minimumFractionDigits:0, maximumFractionDigits:0}) : 0 }}</td>
                                        <td class="p-3 text-center"><span :class="getStatusClass(ad.status)" class="px-2 py-1 rounded text-xs font-bold">{{ ad.status }}</span></td>
                                    </tr>
                                    <tr v-if="adsList.length === 0"><td colspan="6" class="p-6 text-center text-gray-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏Å‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div v-if="adsList.length > 0" class="p-4 border-t bg-gray-50 flex justify-between items-center">
                            <span class="text-xs text-gray-500">‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤ {{ currentPage }} / {{ totalPages }}</span>
                            <div class="flex gap-2"><button @click="prevPage" :disabled="currentPage === 1" class="px-2 py-1 border rounded hover:bg-gray-100 disabled:opacity-50"><i class="fa-solid fa-chevron-left"></i></button><button @click="nextPage" :disabled="currentPage === totalPages" class="px-2 py-1 border rounded hover:bg-gray-100 disabled:opacity-50"><i class="fa-solid fa-chevron-right"></i></button></div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                        <div class="p-4 border-b bg-gray-50 font-bold text-gray-700">Logs (Facebook)</div>
                        <div class="max-h-48 overflow-y-auto"><table class="w-full text-xs text-left"><tbody><tr v-for="log in logsList" class="border-b hover:bg-gray-50"><td class="p-3 text-gray-400 w-32">{{ log.timestamp }}</td><td class="p-3 font-medium">{{ log.message }}</td></tr></tbody></table></div>
                    </div>
                </div>

                <div v-if="currentView === 'tiktok'" class="space-y-6 animate-fade-in">
                    <div class="flex space-x-2 border-b border-gray-200 pb-2">
                        <button @click="tiktokTab = 'monitor'" :class="tiktokTab === 'monitor' ? 'bg-black text-white' : 'bg-gray-100 text-gray-600'" class="px-4 py-2 rounded-lg text-sm font-bold transition flex items-center"><i class="fa-solid fa-chart-pie mr-2"></i> Monitor</button>
                        <button @click="tiktokTab = 'spark'" :class="tiktokTab === 'spark' ? 'bg-black text-white' : 'bg-gray-100 text-gray-600'" class="px-4 py-2 rounded-lg text-sm font-bold transition flex items-center"><i class="fa-solid fa-fire mr-2"></i> Spark Ads</button>
                        <button @click="tiktokTab = 'comments'" :class="tiktokTab === 'comments' ? 'bg-black text-white' : 'bg-gray-100 text-gray-600'" class="px-4 py-2 rounded-lg text-sm font-bold transition flex items-center"><i class="fa-solid fa-comments mr-2"></i> Comments</button>
                        <button @click="tiktokTab = 'rules'" :class="tiktokTab === 'rules' ? 'bg-black text-white' : 'bg-gray-100 text-gray-600'" class="px-4 py-2 rounded-lg text-sm font-bold transition flex items-center"><i class="fa-solid fa-gavel mr-2"></i> Rules</button>
                    </div>

                    <div v-if="tiktokTab === 'monitor'" class="space-y-6">
                        <div class="bg-red-50 border border-red-100 p-4 rounded-xl flex items-start gap-3"><i class="fa-solid fa-triangle-exclamation text-red-500 mt-1"></i><div><h4 class="font-bold text-red-800 text-sm">Creative Fatigue Alert</h4><p class="text-xs text-red-600">‡∏û‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏°‡∏µ CTR ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå (0.5%) ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p></div></div>
                        <div class="bg-white rounded-xl shadow-sm overflow-hidden border border-gray-100">
                            <div class="p-4 border-b bg-gray-50 font-bold text-gray-700">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤ (Simulation)</div>
                            <table class="w-full text-sm text-left">
                                <thead class="bg-gray-100 text-gray-600 uppercase text-xs"><tr><th class="p-3">Video Name</th><th class="p-3 text-right">Spend</th><th class="p-3 text-center">CTR %</th><th class="p-3 text-center">Status</th></tr></thead>
                                <tbody>
                                    <tr class="border-b hover:bg-gray-50"><td class="p-3 font-medium">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ñ‡∏£‡∏µ‡∏° V.1</td><td class="p-3 text-right">5,400 ‡∏ø</td><td class="p-3 text-center text-red-500 font-bold">0.42% üìâ</td><td class="p-3 text-center"><span class="bg-red-100 text-red-600 px-2 py-1 rounded text-xs font-bold">Fatigue</span></td></tr>
                                    <tr class="border-b hover:bg-gray-50"><td class="p-3 font-medium">‡πÄ‡∏ï‡πâ‡∏ô‡πÄ‡∏û‡∏•‡∏á‡∏Æ‡∏¥‡∏ï V.2</td><td class="p-3 text-right">12,500 ‡∏ø</td><td class="p-3 text-center text-green-600 font-bold">1.85%</td><td class="p-3 text-center"><span class="bg-green-100 text-green-600 px-2 py-1 rounded text-xs font-bold">Active</span></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div v-if="tiktokTab === 'spark'" class="space-y-4">
                        <div class="flex justify-between items-center"><h3 class="font-bold text-gray-700">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏•‡∏¥‡∏õ‡∏à‡∏≤‡∏Å‡∏ä‡πà‡∏≠‡∏á‡∏°‡∏≤‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ó</h3></div>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                            <div class="bg-white p-4 rounded-xl border border-gray-200 hover:shadow-md transition">
                                <div class="bg-gray-200 h-48 rounded-lg mb-3 flex items-center justify-center text-gray-400 relative"><i class="fa-solid fa-play text-4xl"></i><span class="absolute bottom-2 right-2 bg-black/50 text-white text-xs px-2 py-1 rounded">15.4K Views</span></div>
                                <div class="flex justify-between items-center mt-3"><div class="text-xs text-gray-500"><i class="fa-solid fa-heart text-pink-500"></i> 1.2K</div><button class="bg-black hover:bg-gray-800 text-white text-xs font-bold px-3 py-1.5 rounded-lg">Boost</button></div>
                            </div>
                        </div>
                    </div>

                    <div v-if="tiktokTab === 'comments'" class="space-y-4">
                        <div class="bg-white p-6 rounded-xl border border-gray-200">
                            <div class="mb-4"><label class="block text-sm font-bold text-gray-700 mb-1">‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô</label><textarea class="w-full border p-2 rounded text-sm h-20">‡πÇ‡∏Å‡∏á, ‡∏õ‡∏•‡∏≠‡∏°, ‡πÅ‡∏û‡∏á‡πÄ‡∏Å‡∏¥‡∏ô, ‡∏´‡∏•‡∏≠‡∏Å‡∏•‡∏ß‡∏á</textarea></div>
                            <button class="bg-green-600 text-white text-sm font-bold px-4 py-2 rounded-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏≥‡∏Å‡∏£‡∏≠‡∏á</button>
                        </div>
                    </div>

                    <div v-if="tiktokTab === 'rules'" class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="bg-indigo-50 p-6 rounded-xl border border-indigo-100"><h3 class="font-bold text-indigo-900 mb-2">Surf Scaling</h3><input type="number" class="w-full border p-2 rounded mt-1" placeholder="Target CPR"></div>
                            <div class="bg-red-50 p-6 rounded-xl border border-red-100"><h3 class="font-bold text-red-900 mb-2">Safety Net</h3><input type="number" class="w-full border p-2 rounded mt-1" placeholder="Max CPR Limit"></div>
                        </div>
                    </div>
                </div>

                <div v-if="currentView === 'settings'" class="space-y-6 animate-fade-in">
                    <div class="bg-white rounded-xl shadow-sm p-8 space-y-6">
                        <h3 class="font-bold text-gray-700 border-b pb-4">üîë ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (Facebook)</h3>
                        <div class="flex items-center justify-between bg-gray-50 p-4 rounded-lg border"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center text-xl"><i class="fa-brands fa-facebook-f"></i></div><div><p class="font-bold text-gray-800">Facebook Ads</p><p class="text-xs" :class="settings.fbToken ? 'text-green-600' : 'text-red-500'">{{ settings.fbToken ? '‚óè ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß' : '‚óè ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠' }}</p></div></div><button @click="connectFacebook" class="text-blue-600 hover:text-blue-800 font-bold text-sm">Reconnect</button></div>
                        <div class="flex gap-2"><div class="relative w-full"><select v-model="settings.adAccountId" class="w-full border p-2 pl-3 pr-10 rounded text-sm bg-white"><option value="" disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ --</option><option v-for="acc in adAccountsList" :value="acc.id">{{ acc.name }} ({{ acc.currency }})</option></select></div><button @click="fetchAdAccounts" class="text-indigo-600 border p-2 rounded hover:bg-indigo-50"><i class="fa-solid fa-rotate"></i></button></div>
                        <h3 class="font-bold text-gray-700 border-b pb-4 pt-4">ü§ñ ‡∏Å‡∏é‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Global Rules)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div><label class="block text-sm font-bold text-red-800">Stop Loss</label><input v-model.number="settings.stopLossLimit" type="number" class="w-full border p-2 rounded mt-1"></div><div><label class="block text-sm font-bold text-green-800">Target ROAS</label><input v-model.number="settings.targetRoas" type="number" step="0.1" class="w-full border p-2 rounded mt-1"></div><div><label class="block text-sm font-bold text-blue-800">Profit Margin %</label><input v-model.number="settings.profitMargin" type="number" class="w-full border p-2 rounded mt-1"></div></div>
                        <div class="flex justify-end pt-4"><button @click="saveSettings(true)" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-xl shadow hover:bg-indigo-700">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button></div>
                    </div>
                </div>

            </div>
        </main>

        <div v-if="showAiModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-opacity"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-fade-in"><div class="bg-gradient-to-r from-purple-600 to-indigo-600 p-4 flex justify-between items-center text-white"><h3 class="font-bold text-lg"><i class="fa-solid fa-robot mr-2"></i> AI Writer</h3><button @click="showAiModal = false"><i class="fa-solid fa-xmark text-xl"></i></button></div><div class="p-6 space-y-4"><div><label class="block text-sm font-bold text-gray-700 mb-1">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label><input v-model="aiForm.product" class="w-full border p-2 rounded outline-none" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏≤‡πÅ‡∏ü..."></div><div><label class="block text-sm font-bold text-gray-700 mb-1">‡∏™‡πÑ‡∏ï‡∏•‡πå</label><select v-model="aiForm.tone" class="w-full border p-2 rounded bg-white"><option value="‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô">üî• Hard Sell</option><option value="‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡∏ï‡∏•‡∏Å ‡πÄ‡∏Æ‡∏Æ‡∏≤">ü§£ ‡∏ï‡∏•‡∏Å ‡πÄ‡∏Æ‡∏Æ‡∏≤</option></select></div><div v-if="aiResult" class="bg-gray-50 p-4 rounded-lg border mt-4 relative"><textarea readonly class="w-full h-32 bg-transparent text-sm resize-none outline-none" :value="aiResult"></textarea><button @click="copyToClipboard(aiResult)" class="absolute top-2 right-2 text-gray-400 hover:text-indigo-600"><i class="fa-regular fa-copy"></i></button></div><button @click="generateCopy" :disabled="aiLoading" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 rounded-xl shadow"><i v-if="aiLoading" class="fa-solid fa-circle-notch fa-spin mr-2"></i> {{ aiLoading ? 'Thinking...' : 'Generate' }}</button></div></div></div>
        <div v-if="showHunterModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-opacity"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden animate-fade-in flex flex-col max-h-[80vh]"><div class="bg-gradient-to-r from-blue-600 to-indigo-600 p-4 flex justify-between items-center text-white shrink-0"><h3 class="font-bold text-lg"><i class="fa-solid fa-crosshairs mr-2"></i> Interest Hunter</h3><button @click="showHunterModal = false"><i class="fa-solid fa-xmark text-xl"></i></button></div><div class="p-6 overflow-y-auto custom-scrollbar"><div class="flex gap-2 mb-4"><input v-model="hunterKeyword" @keyup.enter="searchInterests" class="flex-1 border p-3 rounded-lg outline-none" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏µ‡∏¢‡πå‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏î..."><button @click="searchInterests" :disabled="hunterLoading" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 rounded-lg font-bold shadow"><i v-if="hunterLoading" class="fa-solid fa-circle-notch fa-spin mr-2"></i> ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button></div><div v-if="interestResults.length > 0" class="space-y-2"><div v-for="item in interestResults" :key="item.id" class="flex justify-between items-center p-3 border rounded-lg hover:bg-indigo-50 cursor-pointer" @click="copyToClipboard(item.name)"><div><div class="font-bold text-gray-800">{{ item.name }}</div><div class="text-xs text-gray-500">{{ formatNumber(item.audience_size) }} ‡∏Ñ‡∏ô</div></div><button class="text-gray-300 group-hover:text-indigo-600"><i class="fa-regular fa-copy"></i></button></div></div></div></div></div>
        <div v-if="showSpyModal" class="fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4 backdrop-blur-sm transition-opacity"><div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-fade-in"><div class="bg-gradient-to-r from-gray-700 to-black p-4 flex justify-between items-center text-white"><h3 class="font-bold text-lg"><i class="fa-solid fa-user-secret mr-2"></i> Spy Tool</h3><button @click="showSpyModal = false"><i class="fa-solid fa-xmark text-xl"></i></button></div><div class="p-6"><div class="flex gap-2 mb-2"><input v-model="spyKeyword" @keyup.enter="searchPages" class="flex-1 border p-3 rounded-lg outline-none" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏à..."><button @click="searchPages" class="bg-black hover:bg-gray-800 text-white px-6 rounded-lg font-bold shadow">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button></div><p class="text-xs text-gray-500">‡πÄ‡∏õ‡∏¥‡∏î Ad Library ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</p></div></div></div>

    </div>

    <script>
        const { createApp, ref, onMounted, computed } = Vue;

        createApp({
            setup() {
                // UI States
                const currentView = ref('overview');
                const tiktokTab = ref('monitor');
                
                // Data
                const user = ref({});
                const settings = ref({});
                const adsList = ref([]);
                const logsList = ref([]);
                const adAccountsList = ref([]);
                const loading = ref(false);
                let chartInstance = null;
                const currentPage = ref(1);
                const itemsPerPage = 25;

                // Tool Vars
                const showAiModal = ref(false); const aiLoading = ref(false); const aiForm = ref({ product: '', tone: '‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏ô‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô' }); const aiResult = ref('');
                const showHunterModal = ref(false); const hunterKeyword = ref(''); const interestResults = ref([]); const hunterLoading = ref(false); const hunterSearched = ref(false);
                const showSpyModal = ref(false); const spyKeyword = ref('');

                const token = localStorage.getItem('quinn_token');
                if (!token) window.location.href = 'index.html';

                const paginatedAds = computed(() => { const start = (currentPage.value - 1) * itemsPerPage; const end = start + itemsPerPage; return adsList.value.slice(start, end); });
                const totalPages = computed(() => Math.ceil(adsList.value.length / itemsPerPage) || 1);
                const nextPage = () => { if (currentPage.value < totalPages.value) currentPage.value++; };
                const prevPage = () => { if (currentPage.value > 1) currentPage.value--; };

                // Overview Stats
                const totalStats = computed(() => {
                    const spend = adsList.value.reduce((sum, ad) => sum + (ad.spend || 0), 0);
                    const revenue = adsList.value.reduce((sum, ad) => sum + ((ad.spend * ad.roas) || 0), 0);
                    const profit = adsList.value.reduce((sum, ad) => sum + (ad.netProfit || 0), 0);
                    const roas = spend > 0 ? (revenue / spend).toFixed(2) : 0;
                    return { spend, sales: revenue, roas, profit, fbSpend: spend };
                });

                const loadData = async () => {
                    user.value = JSON.parse(localStorage.getItem('quinn_user') || '{}');
                    try {
                        const res = await axios.get('http://localhost:3000/api/me/settings', { headers: { 'Authorization': `Bearer ${token}` } });
                        settings.value = res.data;
                        if(settings.value.fbToken) fetchAdAccounts();
                        loadLogs();
                    } catch (e) { if(e.response?.status === 401) logout(); }
                };

                const checkAdsNow = async () => {
                    loading.value = true;
                    try {
                        const res = await axios.get('http://localhost:3000/api/check-now', { headers: { 'Authorization': `Bearer ${token}` } });
                        adsList.value = res.data.data || [];
                        currentPage.value = 1;
                        updateChart(adsList.value);
                        loadLogs();
                    } catch(e) { alert('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + e.message); } 
                    finally { loading.value = false; }
                };

                // Functions
                const searchPages = async () => { if(!spyKeyword.value) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏à'); const url = `https://www.facebook.com/ads/library/?active_status=all&ad_type=all&country=TH&q=${encodeURIComponent(spyKeyword.value)}&search_type=keyword_unordered&media_type=all`; window.open(url, '_blank'); showSpyModal.value = false; };
                const generateCopy = async () => { if(!aiForm.value.product) return; aiLoading.value = true; try { const res = await axios.post('http://localhost:3000/api/ai/generate-copy', aiForm.value, { headers: { 'Authorization': `Bearer ${token}` } }); aiResult.value = res.data.result; } catch (e) { alert(e.message); } finally { aiLoading.value = false; } };
                const searchInterests = async () => { if(!hunterKeyword.value) return; hunterLoading.value = true; try { const res = await axios.get(`http://localhost:3000/api/tools/search-interests?q=${hunterKeyword.value}`, { headers: { 'Authorization': `Bearer ${token}` } }); interestResults.value = res.data.data; } catch (e) { alert(e.message); } finally { hunterLoading.value = false; } };
                const copyToClipboard = (text) => { navigator.clipboard.writeText(text); alert(`‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!`); };
                const loadLogs = async () => { try { const res = await axios.get('http://localhost:3000/api/me/logs', { headers: { 'Authorization': `Bearer ${token}` } }); logsList.value = res.data; } catch(e){} };
                const fetchAdAccounts = async () => { try { const res = await axios.get('http://localhost:3000/api/me/adaccounts', { headers: { 'Authorization': `Bearer ${token}` } }); adAccountsList.value = res.data.accounts; } catch(e){} };
                const saveSettings = async (alertMsg = false) => { try { await axios.post('http://localhost:3000/api/me/settings', settings.value, { headers: { 'Authorization': `Bearer ${token}` } }); if(alertMsg) alert('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß'); } catch(e){} };
                const connectFacebook = async () => { try { const res = await axios.get('http://localhost:3000/api/connect-facebook', { headers: { 'Authorization': `Bearer ${token}` } }); window.location.href = res.data.url; } catch(e){} };
                const updateChart = (data) => { const ctx = document.getElementById('spendChart')?.getContext('2d'); if (!ctx) return; if (chartInstance) chartInstance.destroy(); chartInstance = new Chart(ctx, { type: 'bar', data: { labels: data.map(d => d.name.substring(0,10)), datasets: [{ label: 'Spend', data: data.map(d => d.spend), backgroundColor: '#4F46E5' }] } }); };
                const getStatusClass = (status) => status === 'DANGER' ? 'bg-red-100 text-red-600' : (status === 'SCALING' ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-600');
                const logout = () => { localStorage.clear(); window.location.href = 'index.html'; };
                const formatNumber = (num) => new Intl.NumberFormat('th-TH', { notation: "compact", compactDisplay: "short" }).format(num);

                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('status') === 'success') { alert('üéâ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Facebook ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!'); window.history.replaceState({}, document.title, "dashboard.html"); }
                onMounted(() => loadData());

                return { 
                    currentView, tiktokTab, user, settings, adsList, logsList, adAccountsList, loading, paginatedAds, currentPage, totalPages, totalStats, nextPage, prevPage,
                    checkAdsNow, saveSettings, fetchAdAccounts, connectFacebook, logout, getStatusClass, formatNumber,
                    showAiModal, aiLoading, aiForm, aiResult, generateCopy, 
                    showHunterModal, hunterKeyword, interestResults, hunterLoading, hunterSearched, searchInterests,
                    showSpyModal, spyKeyword, searchPages, copyToClipboard
                };
            }
        }).mount('#app');
    </script>
</body>
</html>